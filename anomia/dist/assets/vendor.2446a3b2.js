var tt=Object.defineProperty,nt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var le=(n,e,t)=>e in n?tt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,U=(n,e)=>{for(var t in e||(e={}))Ce.call(e,t)&&le(n,t,e[t]);if(Q)for(var t of Q(e))Fe.call(e,t)&&le(n,t,e[t]);return n},W=(n,e)=>nt(n,rt(e));var ae=(n,e)=>{var t={};for(var r in n)Ce.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&Q)for(var r of Q(n))e.indexOf(r)<0&&Fe.call(n,r)&&(t[r]=n[r]);return t};var d=(n,e,t)=>(le(n,typeof e!="symbol"?e+"":e,t),t),Pe=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var E=(n,e,t)=>(Pe(n,e,"read from private field"),t?t.call(n):e.get(n)),ue=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Ie=(n,e,t,r)=>(Pe(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);function R(){}function ce(n,e){for(const t in e)n[t]=e[t];return n}function Se(n){return n()}function xe(){return Object.create(null)}function D(n){n.forEach(Se)}function fe(n){return typeof n=="function"}function G(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function st(n){return Object.keys(n).length===0}function Y(n,...e){if(n==null)return R;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function S(n){let e;return Y(n,t=>e=t)(),e}function an(n,e,t){n.$$.on_destroy.push(Y(e,t))}function he(n,e,t,r){if(n){const s=Oe(n,e,t,r);return n[0](s)}}function Oe(n,e,t,r){return n[1]&&r?ce(t.ctx.slice(),n[1](r(e))):t.ctx}function de(n,e,t,r){if(n[2]&&r){const s=n[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const o=[],i=Math.max(e.dirty.length,s.length);for(let a=0;a<i;a+=1)o[a]=e.dirty[a]|s[a];return o}return e.dirty|s}return e.dirty}function me(n,e,t,r,s,o){if(s){const i=Oe(e,t,r,o);n.p(i,s)}}function ge(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function je(n){return n&&fe(n.destroy)?n.destroy:R}function un(n,e){n.appendChild(e)}function k(n,e,t){n.insertBefore(e,t||null)}function N(n){n.parentNode.removeChild(n)}function cn(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function Ae(n){return document.createElement(n)}function He(n){return document.createTextNode(n)}function ot(){return He(" ")}function T(){return He("")}function fn(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function hn(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function it(n){return Array.from(n.childNodes)}function dn(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function mn(n,e){n.value=e==null?"":e}function lt(n,e,t,r){n.style.setProperty(e,t,r?"important":"")}let M;function J(n){M=n}function pe(){if(!M)throw new Error("Function called outside component initialization");return M}function at(n){pe().$$.on_destroy.push(n)}function ve(n,e){pe().$$.context.set(n,e)}function Le(n){return pe().$$.context.get(n)}const K=[],De=[],Z=[],Te=[],ut=Promise.resolve();let _e=!1;function ct(){_e||(_e=!0,ut.then(qe))}function be(n){Z.push(n)}const ye=new Set;let V=0;function qe(){const n=M;do{for(;V<K.length;){const e=K[V];V++,J(e),ft(e.$$)}for(J(null),K.length=0,V=0;De.length;)De.pop()();for(let e=0;e<Z.length;e+=1){const t=Z[e];ye.has(t)||(ye.add(t),t())}Z.length=0}while(K.length);for(;Te.length;)Te.pop()();_e=!1,ye.clear(),J(n)}function ft(n){if(n.fragment!==null){n.update(),D(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(be)}}const $=new Set;let x;function q(){x={r:0,c:[],p:x}}function B(){x.r||D(x.c),x=x.p}function _(n,e){n&&n.i&&($.delete(n),n.i(e))}function b(n,e,t,r){if(n&&n.o){if($.has(n))return;$.add(n),x.c.push(()=>{$.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}}function Be(n,e){const t={},r={},s={$$scope:1};let o=n.length;for(;o--;){const i=n[o],a=e[o];if(a){for(const l in i)l in a||(r[l]=1);for(const l in a)s[l]||(t[l]=a[l],s[l]=1);n[o]=a}else for(const l in i)s[l]=1}for(const i in r)i in t||(t[i]=void 0);return t}function we(n){return typeof n=="object"&&n!==null?n:{}}function O(n){n&&n.c()}function C(n,e,t,r){const{fragment:s,on_mount:o,on_destroy:i,after_update:a}=n.$$;s&&s.m(e,t),r||be(()=>{const l=o.map(Se).filter(fe);i?i.push(...l):D(l),n.$$.on_mount=[]}),a.forEach(be)}function F(n,e){const t=n.$$;t.fragment!==null&&(D(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ht(n,e){n.$$.dirty[0]===-1&&(K.push(n),ct(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ee(n,e,t,r,s,o,i,a=[-1]){const l=M;J(n);const u=n.$$={fragment:null,ctx:null,props:o,update:R,not_equal:s,bound:xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:xe(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(u.root);let c=!1;if(u.ctx=t?t(n,e.props||{},(f,m,...g)=>{const p=g.length?g[0]:m;return u.ctx&&s(u.ctx[f],u.ctx[f]=p)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](p),c&&ht(n,f)),m}):[],u.update(),c=!0,D(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){const f=it(e.target);u.fragment&&u.fragment.l(f),f.forEach(N)}else u.fragment&&u.fragment.c();e.intro&&_(n.$$.fragment),C(n,e.target,e.anchor,e.customElement),qe()}J(l)}class te{$destroy(){F(this,1),this.$destroy=R}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!st(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const z=[];function dt(n,e){return{subscribe:ne(n,e).subscribe}}function ne(n,e=R){let t;const r=new Set;function s(a){if(G(n,a)&&(n=a,t)){const l=!z.length;for(const u of r)u[1](),z.push(u,n);if(l){for(let u=0;u<z.length;u+=2)z[u][0](z[u+1]);z.length=0}}}function o(a){s(a(n))}function i(a,l=R){const u=[a,l];return r.add(u),r.size===1&&(t=e(s)||R),a(n),()=>{r.delete(u),r.size===0&&(t(),t=null)}}return{set:s,update:o,subscribe:i}}function mt(n,e,t){const r=!Array.isArray(n),s=r?[n]:n,o=e.length<2;return dt(t,i=>{let a=!1;const l=[];let u=0,c=R;const f=()=>{if(u)return;c();const g=e(r?l[0]:l,i);o?i(g):c=fe(g)?g:R},m=s.map((g,p)=>Y(g,y=>{l[p]=y,u&=~(1<<p),a&&f()},()=>{u|=1<<p}));return a=!0,f(),function(){D(m),c()}})}const gt=n=>n.name.match(/\[\.\.\.(.+)\]/)?1:-1,pt=n=>{var e;for(const t of[...n].reverse())for(const r of((e=t.node.parent)==null?void 0:e.children)||[])if(r.name.match(/\[\.\.\.(.+)\]/))return r},_t=n=>n.replace(/[?#].+/,"").replace(/\/$/,"").split("/").slice(1),bt=(n,e)=>n.findIndex(t=>t.node===e),yt=n=>Object.entries(n).reduce((e,[t,r])=>W(U({},e),{[t]:decodeURI(r)}),{});class re{constructor(e,t,r){d(this,"_params",{});this.route=e,this.node=t,this.load=void 0,this.urlFragment=r,Object.defineProperty(this,"route",{enumerable:!1})}get params(){return this._params}setParams(e){this._params=yt(e)}getParamsFromFragment(){const{getFieldsFromName:e,getValuesFromPath:t,mapFieldsWithValues:r}=this.route.router.instance.utils;return r(e(this.node.name),t(this.node.regex,this.urlFragment))}}const wt=["pushState","replaceState","popState"];class Rt{constructor(e,t,r){d(this,"allFragments",[]);d(this,"loaded");d(this,"load",{status:200,error:null,maxage:null,props:{},redirect:null});if(this.router=e,this.url=t,this.mode=r,!e.rootNode){this.router.log.error("Can't navigate without a rootNode");const s=new Error("Can't navigate without a rootNode");throw Object.assign(s,{routify:{router:e}}),s}if(!wt.includes(r))throw new Error("url.mode must be pushState, replaceState or popState");this.allFragments=this._createFragments()}get fragments(){const e=this.allFragments.filter(t=>t.node.module);return this.router.transformFragments.run(e)}get params(){const e=this.url.match(/\?.+/),t=e&&e[0]||"";return Object.assign({},...this.allFragments.map(r=>r.params),this.router.queryHandler.parse(t,this))}async loadRoute(){const{router:e}=this,t=[this.runBeforeUrlChangeHooks,this.loadComponents,this.runGuards,this.runPreloads];return this.loaded=new Promise(async(r,s)=>{for(const i of t){const a=await i.bind(this)(),l=this!==e.pendingRoute.get();if(e.pendingRoute.get()){if(l){e.pendingRoute.get().loaded.then(r).catch(s);return}else if(!a){e.pendingRoute.set(null);return}}else{r({route:e.activeRoute.get()});return}}const o=this.router.activeRoute.get();o&&e.history.push(o),e.activeRoute.set(this),e.afterUrlChange.run({route:this,history:[...e.history].reverse()}),e.pendingRoute.set(null),r({route:this})}),this.loaded}async loadComponents(){return await Promise.all(this.fragments.map(async e=>{const t=await e.node.module();e.node.module=()=>t})),!0}async runPreloads(){var t;const e={route:this,node:[...this.fragments].pop().node};for(const r of this.fragments)if(((t=r.node.module())==null?void 0:t.load)&&(r.load=await r.node.module().load(e),Object.assign(this.load,r.load),this.load.redirect))return this.router.url.replace(this.load.redirect);return this}async runGuards(){const e=this.fragments.map(t=>t.node.module()).filter(t=>t==null?void 0:t.guard);for(const t of e)if(console.warn('"guard" will be deprecated. Please use "load.redirect" instead.'),!await t.guard(this))return!1;return!0}async runBeforeUrlChangeHooks(){return await this.router.beforeUrlChange.run({route:this})}_createFragments(){const{url:e="",router:t}=this,{rootNode:r}=t;let s=[],o=r;const i=(c,f,m)=>{const g=new re(this,c,f),p=c.name.match(/\[\.\.\.(.+)\]/);return p?m.push(f):m=[],p?g.setParams({[p[1]]:m}):g.setParams(g.getParamsFromFragment()),g},a=_t(e),l=[new re(this,o,"")];for(let c=0;c<a.length;c++){const f=a[c],m=o.children.filter(p=>!p.name.startsWith("_")),g=m.find(p=>p.name===f)||m.sort(gt).find(p=>p.regex.test(f));if(g)l.push(i(g,f,s)),o=g;else if(s.length)s.push(f);else{const p=pt(l);if(p){const y=bt(l,p),I=l.splice(y);c=c-I.length,l.push(i(p,a[c],s)),o=p}else{const y=o._fallback;if(!y)throw new Error(`router: "${t.name||"[default]"}" could not find route: ${e}`);l.splice(y.level),l.push(new re(this,y,""));break}}}let u=l[l.length-1].node;for(;u;)u=u.children.find(c=>c.name==="index"),u&&l.push(new re(this,u,""));if(!l.filter(({node:c})=>c.module).length)throw new Error(`could not find route: ${e}`);return l}}const Nt=n=>{const e=n.target.closest("a"),t=e&&e.href;if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button||n.key&&n.key!=="Enter"||n.defaultPrevented||!t||e.target||e.host!==location.host)return;const r=new URL(t),s=r.pathname+r.search+r.hash;return n.preventDefault(),s},Et=n=>[...n].reduce((e,[t,r])=>(e[t]=r,e),{}),kt=()=>(({pathname:n,search:e,hash:t})=>n+e+t)(window.location),Ut=n=>{try{return Le(n)}catch{}},ze=(n,e)=>{const t=ne(n,e);return Object.assign(t,{get:()=>S(t)})},Ct=(...n)=>n.map(e=>JSON.stringify([e==null?void 0:e.allFragments,e==null?void 0:e.url])).reduce((e,t)=>e===t&&t);class We{constructor(e){this.router=e,this.log=this.router.log}install(){}uninstall(){}reflect(){}}const Ft=n=>{const e=(n==null?void 0:n.delimiter)||";";return{toRouter:(t,r)=>{const s=r.name?`${r.name}=(.+?)`:"(.+?)",o=new RegExp(`(^|${e})${s}(${e}|$)`),i=t.match(o);return i?i[2]:"/"},toBrowser:t=>t.map(r=>(r.name?`${r.name}=`:"")+r.url.external()).join(e)}};class Pt{constructor(){d(this,"instances",[]);d(this,"browserAdapter",Ft());d(this,"urlFromBrowser",e=>this.browserAdapter.toRouter(kt(),e));typeof window!="undefined"&&(window.__routify=this)}get routers(){return[].concat(...this.instances.map(e=>e.routers))}register(e){return this.instances.push(e),this}}const Re=new Pt,It=/\[(.+?)\]/gm;class St{constructor(e=It){d(this,"getFieldsFromName",e=>[...e.matchAll(this.RE)].map(t=>t[1]));d(this,"getRegexFromName",e=>new RegExp("^"+e.replace(this.RE,"(.+)")+"$"));d(this,"getValuesFromPath",(e,t)=>(t.match(e)||[]).slice(1));d(this,"mapFieldsWithValues",(e,t)=>this.haveEqualLength(e,t)&&e.reduce((r,s,o)=>(r[s]=t[o],r),{}));d(this,"haveEqualLength",(e,t)=>{if(e.length!==t.length)throw new Error(`fields and values should be of same length
fields: ${JSON.stringify(e)}
values: ${JSON.stringify(t)}`);return!0});this.RE=e}}class Ge{constructor(e,t,r){d(this,"instance");d(this,"parent");d(this,"meta",{});d(this,"id");this.instance=r,this.name=e,r.nodeIndex.push(this),this.module=t,Object.defineProperty(this,"Instance",{enumerable:!1}),Object.defineProperty(this,"instance",{enumerable:!1}),Object.defineProperty(this,"parent",{enumerable:!1})}appendChild(e){e.parent=this}createChild(e,t){const r=this.instance.createNode(e,t);return this.appendChild(r),r}get descendants(){return this.instance.nodeIndex.filter(e=>e.ancestors.find(t=>t===this))}remove(){const{nodeIndex:e}=this.instance,t=e.findIndex(r=>r===this);e.splice(t,1)}get ancestors(){let e=this;const t=[];for(;e=e.parent;)t.push(e);return t}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get isRoot(){return this===this.root}get children(){return this.instance.nodeIndex.filter(e=>e.parent===this)}get level(){var e;return(((e=this.parent)==null?void 0:e.level)||0)+1}traverse(e){const t=e.startsWith("/")?this.root:this,r=e.split("/").filter(s=>s!==".").filter(Boolean);try{return r.reduce((o,i)=>i===".."?o.parent:o.children.find(a=>a.name===i),t)}catch(s){console.error("can't resolve path",e,"from",this.path,`
`,s)}}toJSON(){return W(U({},this),{children:[...this.children]})}get path(){return"/"+[this,...this.ancestors].reverse().map(e=>e.name).filter(Boolean).join("/")}}function xt(n){let e;const t=n[4].default,r=he(t,n,n[5],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&32)&&me(r,t,s,s[5],e?de(t,s[5],o,null):ge(s[5]),null)},i(s){e||(_(r,s),e=!0)},o(s){b(r,s),e=!1},d(s){r&&r.d(s)}}}function Ot(n){let e,t,r=n[2]&&Me(n);return{c(){r&&r.c(),e=T()},m(s,o){r&&r.m(s,o),k(s,e,o),t=!0},p(s,o){s[2]?r?(r.p(s,o),o&4&&_(r,1)):(r=Me(s),r.c(),_(r,1),r.m(e.parentNode,e)):r&&(q(),b(r,1,1,()=>{r=null}),B())},i(s){t||(_(r),t=!0)},o(s){b(r),t=!1},d(s){r&&r.d(s),s&&N(e)}}}function Me(n){let e,t;const r=[n[1],{context:n[3]}];let s={$$slots:{default:[jt]},$$scope:{ctx:n}};for(let o=0;o<r.length;o+=1)s=ce(s,r[o]);return e=new n[2]({props:s}),{c(){O(e.$$.fragment)},m(o,i){C(e,o,i),t=!0},p(o,i){const a=i&10?Be(r,[i&2&&we(o[1]),i&8&&{context:o[3]}]):{};i&32&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(o){t||(_(e.$$.fragment,o),t=!0)},o(o){b(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function jt(n){let e;const t=n[4].default,r=he(t,n,n[5],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,o){r&&r.p&&(!e||o&32)&&me(r,t,s,s[5],e?de(t,s[5],o,null):ge(s[5]),null)},i(s){e||(_(r,s),e=!0)},o(s){b(r,s),e=!1},d(s){r&&r.d(s)}}}function At(n){let e,t,r,s;const o=[Ot,xt],i=[];function a(l,u){return l[0].module?0:1}return e=a(n),t=i[e]=o[e](n),{c(){t.c(),r=T()},m(l,u){i[e].m(l,u),k(l,r,u),s=!0},p(l,[u]){let c=e;e=a(l),e===c?i[e].p(l,u):(q(),b(i[c],1,1,()=>{i[c]=null}),B(),t=i[e],t?t.p(l,u):(t=i[e]=o[e](l),t.c()),_(t,1),t.m(r.parentNode,r))},i(l){s||(_(t),s=!0)},o(l){b(t),s=!1},d(l){i[e].d(l),l&&N(r)}}}const Je="routify-fragment-context";function Ht(n,e,t){let{$$slots:r={},$$scope:s}=e,{node:o}=e,{passthrough:i}=e;const a=W(U({},Le(Je)),{node:o});ve(Je,a);let l;return o.module&&o.getRawComponent().then(u=>t(2,l=u)),n.$$set=u=>{"node"in u&&t(0,o=u.node),"passthrough"in u&&t(1,i=u.passthrough),"$$scope"in u&&t(5,s=u.$$scope)},[o,i,l,a,r,s]}class vt extends te{constructor(e){super();ee(this,e,Ht,At,G,{node:0,passthrough:1})}}var A;class Lt extends Ge{constructor(){super(...arguments);ue(this,A,{});d(this,"importTree",e=>{const t=[[this,e]];for(;t.length;){const[s,o]=t.pop(),r=o,{children:i}=r,a=ae(r,["children"]);Object.assign(s,a);for(const l of i){const u=s.createChild(o.name||o.rootName||"");t.push([u,l])}}return this})}get regex(){const{name:e}=this;return E(this,A)[e]||(E(this,A)[e]=this.instance.utils.getRegexFromName(this.name)),E(this,A)[e]}set regex(e){E(this,A)[this.name]=new RegExp(e)}get children(){return this.instance.nodeIndex.filter(t=>t.parent===this).sort((t,r)=>(t.meta.order||0)-(r.meta.order||0))}get pages(){return this.children.filter(e=>e.name!=="index").filter(e=>!e.meta.fallback).filter(e=>!e.name.startsWith("_")).filter(e=>!e.name.includes("[")).filter(e=>{var t;return((t=e.meta)==null?void 0:t.order)!==!1})}getRawComponent(){return this.module&&new Promise(e=>{const t=this.module(),r=t.then?t.then(s=>s.default):t.default;e(r)})}get component(){const e=this;return function(t){return t.props=W(U({},t.props),{passthrough:t.props,node:e}),new vt(U({},t))}}appendChild(e){e.instance&&(e.parent=this)}get _fallback(){var e;return this.children.find(t=>t.meta.fallback)||((e=this.parent)==null?void 0:e._fallback)}}A=new WeakMap;class Dt{constructor(e){d(this,"Node",Ge);d(this,"mode","runtime");d(this,"nodeIndex",[]);d(this,"rootNodes",{})}createNode(e,t){return new this.Node(e,t,this)}}class Tt extends Dt{constructor(e){super();d(this,"Node",Lt);d(this,"mode","runtime");d(this,"routers",[]);d(this,"rootNodes",{});this.options=e,e.routes&&(this.rootNodes[e.routes.rootName||"unnamed"]=this.createNode(e.routes.rootName).importTree(e.routes)),this.utils=new St,this.global=Re.register(this),Object.defineProperty(this,"routers",{enumerable:!1}),this.log=this.global.log}}const Ne=n=>{const e=[],t=r=>(e.push(r),()=>e.splice(e.indexOf(r),1));return t.hooks=e,t.run=n(e),t},qt=n=>Ne(e=>(t,...r)=>e.reduce((s,o)=>(s==null?void 0:s.then)?s.then(i=>o(i,...r)):o(s,...r),t)),j=n=>Ne(e=>(t,...r)=>e.reduce((s,o)=>(s==null?void 0:s.then)?s.then(i=>o(t,...r)):o(t,...r),t)),Bt=n=>Ne(e=>(t,...r)=>e.reduce((s,o)=>(s==null?void 0:s.then)?s.then(i=>i&&o(t,...r)):s&&o(t,...r),t||!0));class zt extends We{constructor(e){super(e);d(this,"reflect",()=>{const{mode:e}=S(this.router.activeRoute);if(e==="popState")return!1;const{routers:t,browserAdapter:r}=this.router.instance.global,s=t.filter(i=>i.urlReflector instanceof this.constructor),o=r.toBrowser(s);history[`${e}Native`]({},"",o)});const{instance:t,urlRewrites:r}=e,{urlFromBrowser:s,browserAdapter:o}=t.global;history.onPushstate||Wt();const i=a=>function(l,u,c){var m,g;const f=(g=(m=l==null?void 0:l.routify)==null?void 0:m.router)!=null?g:!1;if(f===!1)c=o.toRouter(c,e);else if(f!==e.name)return!1;for(const p of r)c=p.toInternal(c,{router:e});e.url[a](c)};this.absorb=()=>e.url.replace(s(e)),this._pushstateHandler=i("push"),this._replacestateHandler=i("replace"),this._popstateHandler=()=>e.url.pop(s(e))}install(){this.hooks=[history.onPushstate(this._pushstateHandler),history.onReplacestate(this._replacestateHandler),history.onPopstate(this._popstateHandler)],S(this.router.activeRoute)?this.reflect():this.absorb()}uninstall(){this.hooks.forEach(e=>e()),setTimeout(()=>this.reflect())}}function Wt(){const n={onPushstate:j(),onReplacestate:j(),onPopstate:j()};Object.assign(history,n);const{pushState:e,replaceState:t}=history;return history.pushStateNative=e,history.replaceStateNative=t,history.pushState=n.onPushstate.run,history.replaceState=n.onReplacestate.run,window.addEventListener("popstate",n.onPopstate.run),!0}class Gt extends We{}const Mt=()=>new Promise(requestAnimationFrame),Jt=(n=100)=>new Promise(e=>{let t;const r=async s=>{clearTimeout(t),await Mt(),t=setTimeout(()=>{e(),removeEventListener("scroll",r)},n)};addEventListener("scroll",r)}),Kt=()=>{const n=ne(!1);return{isScrolling:n,run:({route:t,history:r})=>{var u;const[s,o]=t.url.split("#"),[i,a]=((u=r[0])==null?void 0:u.url.split("#"))||[];if(!o)return;const l=async c=>{const f=s===i,m=document.getElementById(o);if(m&&m.scrollIntoView({behavior:f?"smooth":"auto"}),f&&m&&(n.set(!0),await Jt(),n.set(!1)),!f&&!c){const g=new MutationObserver(l);g.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),setTimeout(g.disconnect.bind(g),500)}};l()}}},Xt={beforeRouterInit:({router:n})=>{const{isScrolling:e,run:t}=Kt();n.afterUrlChange(t),n.scrollHandler={isScrolling:e}}};var Qt=()=>({beforeUrlChange:({route:n})=>{const e=n.allFragments;return e.forEach(t=>{const{reset:r}=t.node.meta;if(r){const s=e.indexOf(t),o=r===!0?s:Number(r),i=s-o;e.splice(i,s)}}),!0}});const Yt=n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t!=null)),Ke=(n,e)=>{e=e||{name:"",beforeRouterInit:[],afterRouterInit:[],urlRewrite:[],beforeUrlChange:[],afterUrlChange:[],transformFragments:[],onDestroy:[]};const o=n,{plugins:t}=o,r=ae(o,["plugins"]);return[...t||[],r].forEach(i=>{"plugin"in i&&Ke(i,e),Object.entries(i).forEach(([a,l])=>{Array.isArray(e[a])?e[a].push(...[l].flat().filter(Boolean)):e[a]=l||e[a]})}),e},Zt=[Xt,Qt()];var P;const Ee=class{constructor(e){d(this,"pendingRoute",ze(null));d(this,"activeRoute",ze(null));ue(this,P,null);d(this,"urlRewrites",[]);d(this,"beforeRouterInit",j());d(this,"afterRouterInit",j());d(this,"beforeUrlChange",Bt());d(this,"afterUrlChange",j());d(this,"transformFragments",qt());d(this,"onDestroy",j());d(this,"parentElem",null);d(this,"queryHandler",{parse:(e,t)=>Et(new URLSearchParams(e)),stringify:(e,t)=>{const r=new URLSearchParams(e).toString();return r?`?${r}`:""}});d(this,"url",{internal:()=>this.url.getPending()||this.url.getActive(),external:()=>this.getExternalUrl(),getActive:()=>{var e;return(e=S(this.activeRoute))==null?void 0:e.url},getPending:()=>{var e;return(e=S(this.pendingRoute))==null?void 0:e.url},toString:()=>this.url.internal(),set:this._setUrl,push:e=>this._setUrl(e,"pushState"),replace:e=>this._setUrl(e,"replaceState"),pop:e=>this._setUrl(e,"popState")});d(this,"ready",(()=>new Promise(e=>{let t;t=this.activeRoute.subscribe(r=>{r&&e(),t&&t()})}))());d(this,"history",[]);d(this,"setParentElem",e=>this.parentElem=e);d(this,"getExternalUrl",e=>this.urlRewrites.reduce((r,s)=>s.toExternal(r,{router:this}),e||this.url.internal()));d(this,"getInternalUrl",e=>this.urlRewrites.reduce((t,r)=>r.toInternal(t,{router:this}),e));const{subscribe:t,set:r}=ne(this);this.subscribe=t,this.triggerStore=()=>r(this),e.plugins=[...e.plugins||[],...Zt].filter(Boolean),this.init(e),this.params=mt(this.activeRoute,s=>s.params),this.afterUrlChange(()=>setTimeout(()=>E(this,P).reflect())),this.activeRoute.get=()=>S(this.activeRoute),this.pendingRoute.get=()=>S(this.pendingRoute)}init(e){const t=!this.options;e=Yt(e),this.options=Ke(U(U({},this.options),e));let{instance:r,rootNode:s,name:o,routes:i,urlRewrite:a,urlReflector:l,url:u,passthrough:c,beforeUrlChange:f,afterUrlChange:m,transformFragments:g,onDestroy:p,beforeRouterInit:y,afterRouterInit:I,queryHandler:H}=this.options;H&&(this.queryHandler=H),f.forEach(this.beforeUrlChange),g.forEach(this.transformFragments),m.forEach(this.afterUrlChange),p.forEach(this.onDestroy),y.forEach(this.beforeRouterInit),I.forEach(this.afterRouterInit),this.beforeRouterInit.run({router:this,firstInit:t});const w=Ut("routify-fragment-context");this.instance=r||this.instance||(w==null?void 0:w.route.router.instance)||Re.instances[0]||new Tt({}),this.name=o,this.urlRewrites=a,c&&!(c instanceof Ee)&&(c=(w==null?void 0:w.route.router)||c),this.passthrough=c||this.passthrough,Re.instances.forEach(v=>{const L=v.routers.indexOf(this);L!==-1&&v.routers.splice(L,1)}),this.instance.routers.push(this),i&&this.importRoutes(i),this.parentCmpCtx=w,this.rootNode=s||this.rootNode||this.instance.rootNodes.default,this.url.getActive()&&this._setUrl(this.url.getActive(),"pushState",!0),(!this.urlReflector||l&&!(this.urlReflector instanceof l))&&(l=l||(typeof window!="undefined"?zt:Gt),this.setUrlReflector(l)),u&&this.url.replace(u),this.triggerStore(),this.afterRouterInit.run({router:this,firstInit:t})}importRoutes(e){this.rootNode=this.instance.createNode().importTree(e),this.instance.rootNodes[e.rootName||"unnamed"]=this.rootNode}async _setUrl(e,t,r){r||(e=this.getInternalUrl(e)),e=e||"/",e=e.replace(/(.+)\/+([#?]|$)/,"$1$2");const{activeRoute:s,pendingRoute:o}=this;s.get(),e.startsWith("/")||(e=e.replace(new URL(e).origin,""));const i=new Rt(this,e,t),a=o.get()||s.get();return Ct(a,i)||(o.set(i),await i.loadRoute()),!0}destroy(){this.instance.routers=this.instance.routers.filter(e=>e!==this),this.onDestroy.run({router:this})}get urlReflector(){return E(this,P)}setUrlReflector(e){var t;(t=E(this,P))==null||t.uninstall(),Ie(this,P,new e(this)),E(this,P).install(),this.triggerStore()}};let Xe=Ee;P=new WeakMap;function Vt(n){let e;const t=n[2].default,r=he(t,n,n[1],null);return{c(){r&&r.c()},m(s,o){r&&r.m(s,o),e=!0},p(s,[o]){r&&r.p&&(!e||o&2)&&me(r,t,s,s[1],e?de(t,s[1],o,null):ge(s[1]),null)},i(s){e||(_(r,s),e=!0)},o(s){b(r,s),e=!1},d(s){r&&r.d(s)}}}function $t(n,e,t){let{$$slots:r={},$$scope:s}=e,{context:o=null}=e;return n.$$set=i=>{"context"in i&&t(0,o=i.context),"$$scope"in i&&t(1,s=i.$$scope)},[o,s,r]}class Qe extends te{constructor(e){super();ee(this,e,$t,Vt,G,{context:0})}}function Ye(n){let e,t;return e=new Ze({props:{fragments:n[5],props:n[1],decorator:n[0]}}),{c(){O(e.$$.fragment)},m(r,s){C(e,r,s),t=!0},p(r,s){const o={};s&32&&(o.fragments=r[5]),s&2&&(o.props=r[1]),s&1&&(o.decorator=r[0]),e.$set(o)},i(r){t||(_(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function en(n){let e,t,r=n[5].length&&Ye(n);return{c(){r&&r.c(),e=T()},m(s,o){r&&r.m(s,o),k(s,e,o),t=!0},p(s,o){s[5].length?r?(r.p(s,o),o&32&&_(r,1)):(r=Ye(s),r.c(),_(r,1),r.m(e.parentNode,e)):r&&(q(),b(r,1,1,()=>{r=null}),B())},i(s){t||(_(r),t=!0)},o(s){b(r),t=!1},d(s){r&&r.d(s),s&&N(e)}}}function tn(n){var a;let e,t,r;const s=[{context:n[2]},n[1],(a=n[4])==null?void 0:a.props];var o=n[3].node.module().default;function i(l){let u={$$slots:{default:[en,({props:c,decorator:f})=>({1:c,0:f}),({props:c,decorator:f})=>(c?2:0)|(f?1:0)]},$$scope:{ctx:l}};for(let c=0;c<s.length;c+=1)u=ce(u,s[c]);return{props:u}}return o&&(e=new o(i(n))),{c(){e&&O(e.$$.fragment),t=T()},m(l,u){e&&C(e,l,u),k(l,t,u),r=!0},p(l,u){var f;const c=u&22?Be(s,[u&4&&{context:l[2]},u&2&&we(l[1]),u&16&&we((f=l[4])==null?void 0:f.props)]):{};if(u&547&&(c.$$scope={dirty:u,ctx:l}),o!==(o=l[3].node.module().default)){if(e){q();const m=e;b(m.$$.fragment,1,0,()=>{F(m,1)}),B()}o?(e=new o(i(l)),O(e.$$.fragment),_(e.$$.fragment,1),C(e,t.parentNode,t)):e=null}else o&&e.$set(c)},i(l){r||(e&&_(e.$$.fragment,l),r=!0)},o(l){e&&b(e.$$.fragment,l),r=!1},d(l){l&&N(t),e&&F(e,l)}}}function nn(n){let e,t,r;var s=n[0]||Qe;function o(i){return{props:{context:i[2],$$slots:{default:[tn]},$$scope:{ctx:i}}}}return s&&(e=new s(o(n))),{c(){e&&O(e.$$.fragment),t=T()},m(i,a){e&&C(e,i,a),k(i,t,a),r=!0},p(i,[a]){const l={};if(a&4&&(l.context=i[2]),a&575&&(l.$$scope={dirty:a,ctx:i}),s!==(s=i[0]||Qe)){if(e){q();const u=e;b(u.$$.fragment,1,0,()=>{F(u,1)}),B()}s?(e=new s(o(i)),O(e.$$.fragment),_(e.$$.fragment,1),C(e,t.parentNode,t)):e=null}else s&&e.$set(l)},i(i){r||(e&&_(e.$$.fragment,i),r=!0)},o(i){e&&b(e.$$.fragment,i),r=!1},d(i){i&&N(t),e&&F(e,i)}}}function rn(n,e,t){let r,s,o,i,a,{fragments:l}=e,{decorator:u=null}=e,{props:c={}}=e,f={};return ve("routify-fragment-context",f),n.$$set=m=>{"fragments"in m&&t(6,l=m.fragments),"decorator"in m&&t(0,u=m.decorator),"props"in m&&t(1,c=m.props)},n.$$.update=()=>{n.$$.dirty&64&&t(3,[r,...s]=[...l],r,(t(5,s),t(6,l))),n.$$.dirty&8&&t(7,{node:o,load:i,route:a}=r,o,(t(4,i),t(3,r),t(6,l)),(t(8,a),t(3,r),t(6,l))),n.$$.dirty&412&&t(2,f=Object.assign(f,{route:a,node:o,load:i,fragment:r}))},[u,c,f,r,i,s,l,o,a]}class Ze extends te{constructor(e){super();ee(this,e,rn,nn,G,{fragments:6,decorator:0,props:1})}}function Ve(n){let e,t,r,s,o,i;return t=new Ze({props:{fragments:n[2],decorator:n[1]}}),{c(){e=Ae("div"),O(t.$$.fragment),lt(e,"display","contents")},m(a,l){k(a,e,l),C(t,e,null),s=!0,o||(i=je(r=n[5].call(null,e)),o=!0)},p(a,l){const u={};l&4&&(u.fragments=a[2]),l&2&&(u.decorator=a[1]),t.$set(u)},i(a){s||(_(t.$$.fragment,a),s=!0)},o(a){b(t.$$.fragment,a),s=!1},d(a){a&&N(e),F(t),o=!1,i()}}}function $e(n){let e,t,r,s;return{c(){e=Ae("div")},m(o,i){k(o,e,i),r||(s=je(t=n[0].setParentElem(e)),r=!0)},d(o){o&&N(e),r=!1,s()}}}function sn(n){let e,t,r,s=n[3]&&Ve(n),o=!n[0].parentElem&&$e(n);return{c(){s&&s.c(),e=ot(),o&&o.c(),t=T()},m(i,a){s&&s.m(i,a),k(i,e,a),o&&o.m(i,a),k(i,t,a),r=!0},p(i,[a]){i[3]?s?(s.p(i,a),a&8&&_(s,1)):(s=Ve(i),s.c(),_(s,1),s.m(e.parentNode,e)):s&&(q(),b(s,1,1,()=>{s=null}),B()),i[0].parentElem?o&&(o.d(1),o=null):o||(o=$e(i),o.c(),o.m(t.parentNode,t))},i(i){r||(_(s),r=!0)},o(i){b(s),r=!1},d(i){s&&s.d(i),i&&N(e),o&&o.d(i),i&&N(t)}}}function on(n,e,t){let r,s,o,i=R,a=()=>(i(),i=Y(r,h=>t(3,o=h)),r);n.$$.on_destroy.push(()=>i());let{router:l=null}=e,{routes:u=null}=e,{decorator:c=null}=e,{urlReflector:f=null}=e,{instance:m=null}=e,{urlRewrite:g=null}=e,{url:p=null}=e,{name:y=null}=e,{rootNode:I=null}=e,{passthrough:H=null}=e,{beforeRouterInit:w=null}=e,{afterRouterInit:X=null}=e,{beforeUrlChange:v=null}=e,{afterUrlChange:L=null}=e,{transformFragments:se=null}=e,{onDestroy:oe=null}=e,{plugins:ie=null}=e;const et=h=>{l.passthrough||(h.addEventListener("click",ke),h.addEventListener("keydown",ke))},ke=h=>{const Ue=Nt(h);Ue&&l.url.push(Ue)};return typeof window!="undefined"&&at(()=>l.destroy()),n.$$set=h=>{"router"in h&&t(0,l=h.router),"routes"in h&&t(6,u=h.routes),"decorator"in h&&t(1,c=h.decorator),"urlReflector"in h&&t(7,f=h.urlReflector),"instance"in h&&t(8,m=h.instance),"urlRewrite"in h&&t(9,g=h.urlRewrite),"url"in h&&t(10,p=h.url),"name"in h&&t(11,y=h.name),"rootNode"in h&&t(12,I=h.rootNode),"passthrough"in h&&t(13,H=h.passthrough),"beforeRouterInit"in h&&t(14,w=h.beforeRouterInit),"afterRouterInit"in h&&t(15,X=h.afterRouterInit),"beforeUrlChange"in h&&t(16,v=h.beforeUrlChange),"afterUrlChange"in h&&t(17,L=h.afterUrlChange),"transformFragments"in h&&t(18,se=h.transformFragments),"onDestroy"in h&&t(19,oe=h.onDestroy),"plugins"in h&&t(20,ie=h.plugins)},n.$$.update=()=>{if(n.$$.dirty&2096065){const h={instance:m,rootNode:I,name:y,routes:u,urlRewrite:g,urlReflector:f,passthrough:H,beforeRouterInit:w,afterRouterInit:X,beforeUrlChange:v,afterUrlChange:L,transformFragments:se,onDestroy:oe,plugins:ie};l?l.init(h):t(0,l=new Xe(h))}n.$$.dirty&1025&&p&&p!==l.url.internal()&&l.url.replace(p),n.$$.dirty&1&&a(t(4,r=l.activeRoute)),n.$$.dirty&8&&t(2,s=(o==null?void 0:o.fragments)||[]),n.$$.dirty&5},[l,c,s,o,r,et,u,f,m,g,p,y,I,H,w,X,v,L,se,oe,ie]}class gn extends te{constructor(e){super();ee(this,e,on,sn,G,{router:0,routes:6,decorator:1,urlReflector:7,instance:8,urlRewrite:9,url:10,name:11,rootNode:12,passthrough:13,beforeRouterInit:14,afterRouterInit:15,beforeUrlChange:16,afterUrlChange:17,transformFragments:18,onDestroy:19,plugins:20})}}export{gn as R,te as S,b as a,ot as b,O as c,F as d,Ae as e,hn as f,k as g,un as h,ee as i,mn as j,fe as k,fn as l,C as m,R as n,q as o,B as p,N as q,D as r,G as s,_ as t,an as u,He as v,ne as w,dn as x,T as y,cn as z};
